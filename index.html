<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>QSL Digital â€“ LW3DMV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { background:#0f1b2d; color:white; font-family:Arial,sans-serif; margin:0; padding:10px; font-size:1em; }
header { background:#1e2a44; padding:15px; text-align:center; border-radius:5px; margin-bottom:12px; }
header h1 { color:#1ed6ff; margin:0; font-size:1.5em; }
header p { font-size:0.95em; margin:4px 0 0 0; }
#utcClock { font-size:1em; margin-top:4px; color:#1ed6ff; }
.container { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.section { background:#162b44; padding:12px; border-radius:8px; font-size:1em; }
input, button, textarea, select { width:100%; padding:8px; margin:4px 0; border-radius:4px; border:1px solid #1e90ff; background:#0f1b2d; color:white; box-sizing:border-box; font-size:1em; }
textarea { resize:none; height:60px; }
button { background:#1e90ff; border:none; cursor:pointer; transition:0.3s; font-size:1em; }
button:hover { background:#1ed6ff; color:black; }
#calendar { background:#162b44; padding:6px; border-radius:6px; margin-top:4px; }
#calendar-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; text-align:center; font-size:0.9em; }
.day { background:#1a2a44; padding:8px; border-radius:4px; min-height:70px; display:flex; flex-direction:column; justify-content:flex-start; align-items:center; font-size:0.9em; position:relative; }
.day span.activity-name { display:block; background:#1ed6ff; color:#000; border-radius:3px; padding:3px; margin-top:4px; font-size:0.8em; max-width:90%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
#qsoDataContainer div { background:#1a2a44; padding:6px; margin-bottom:4px; border-radius:6px; font-size:0.9em; }
#qslDownloadsSection { background:#1a2a44; padding:6px; margin-top:8px; border-radius:6px; font-size:0.9em; }
#qslDownloadsSection h3 { color:#1ed6ff; margin-top:0; font-size:1em; }
#soporte { margin-top:8px; font-size:0.85em; text-align:center; color:#1ed6ff; }
#qslPreviewContainerIndividual img { margin-right:4px; margin-top:4px; width:70px; height:70px; object-fit:cover; border:2px solid #1ed6ff; border-radius:4px; cursor:pointer; }
</style>
</head>
<body>

<header>
  <h1>ðŸ“¡ QSL Digital â€“ LW3DMV</h1>
  <p id="bienvenidoMensaje">Bienvenido LW3DMV</p>
  <div id="utcClock">UTC: --:--</div>
</header>

<div class="container">

  <!-- QSO -->
  <div class="section" style="display:flex; align-items:flex-start; gap:12px;">
    <div id="qsoDataContainer" style="flex:1; display:flex; flex-direction:column; gap:6px;">
      <h3 style="margin:0 0 4px 0; color:#1ed6ff;">Datos del QSO</h3>
    </div>
  </div>

  <!-- Actividades -->
  <div class="section">
    <h2>Nueva Actividad</h2>
    <input type="text" id="actividadNombre" placeholder="Nombre de la actividad">
    <label>Inicio</label>
    <input type="date" id="actividadInicioFecha">
    <input type="time" id="actividadInicioHora">
    <label>Fin</label>
    <input type="date" id="actividadFinFecha">
    <input type="time" id="actividadFinHora">
    <button onclick="guardarActividad()">Agregar Actividad</button>
    <div id="actividadLogs" style="max-height:180px; overflow-y:auto; margin-top:6px;"></div>
  </div>

  <!-- Contactos Individuales -->
  <div class="section">
    <h2>Contactos Individuales / Log</h2>
    <label>Actividad (opcional)</label>
    <select id="actividadSelectIndividual"><option value="">-- Ninguna --</option></select>
    <label>QSL asociada</label>
    <input type="file" id="qslFileIndividual" accept="image/*">
    <div id="qslPreviewContainerIndividual"></div>
    <input type="text" id="contactCall" placeholder="Indicativo">
    <input type="date" id="contactDate">
    <input type="time" id="contactTime">
    <input type="text" id="contactBand" placeholder="Banda">
    <input type="text" id="contactMode" placeholder="Modo">
    <input type="text" id="contactRST" placeholder="RST">
    <button onclick="agregarContactoIndividual()">Agregar Contacto</button>
  </div>

  <!-- Calendario -->
  <div class="section">
    <h2>Calendario</h2>
    <div id="calendar-grid"></div>
  </div>

</div>

<!-- Descargas QSL -->
<div id="qslDownloadsSection">
  <h3>Descargas de QSL</h3>
  <div id="qslDownloads"></div>
</div>

<div id="soporte">ðŸ“§ Soporte: <a href="mailto:lw3dmv@gmail.com">lw3dmv@gmail.com</a></div>

<canvas id="qslCanvas" width="1000" height="600" style="display:none;"></canvas>

<script>
let actividades = [];
let operadorLicencia = "LW3DMV";

document.getElementById("bienvenidoMensaje").innerText=`Bienvenido ${operadorLicencia}`;

// RELOJ UTC
function actualizarUTC(){
  const now = new Date();
  const utc = new Date(now.getTime() + now.getTimezoneOffset()*60000);
  document.getElementById("utcClock").innerText = "UTC: "+utc.getUTCHours().toString().padStart(2,'0')+":"+utc.getUTCMinutes().toString().padStart(2,'0');
}
setInterval(actualizarUTC,1000); actualizarUTC();

// ACTIVIDADES
function actualizarDropdownActividades(){
  const selectInd = document.getElementById("actividadSelectIndividual");
  selectInd.innerHTML = '<option value="">-- Ninguna --</option>';
  actividades.forEach((act, idx)=>{
    const opt = document.createElement("option");
    opt.value = idx;
    opt.innerText = act.nombre;
    selectInd.appendChild(opt);
  });
}

function guardarActividad(){
  const nombre = document.getElementById("actividadNombre").value.trim();
  const inicioF = document.getElementById("actividadInicioFecha").value;
  const inicioH = document.getElementById("actividadInicioHora").value;
  const finF = document.getElementById("actividadFinFecha").value;
  const finH = document.getElementById("actividadFinHora").value;
  if(!nombre || !inicioF || !inicioH || !finF || !finH){ alert("Completa todos los datos"); return; }

  actividades.push({nombre,inicioF,inicioH,finF,finH,contactos:[]}); 
  renderActividades(); renderCalendario(); actualizarDropdownActividades();

  document.getElementById("actividadNombre").value="";
  document.getElementById("actividadInicioFecha").value="";
  document.getElementById("actividadInicioHora").value="";
  document.getElementById("actividadFinFecha").value="";
  document.getElementById("actividadFinHora").value="";
}

// ACTIVIDADES EN LISTA
function renderActividades(){
  const div=document.getElementById("actividadLogs"); div.innerHTML="";
  actividades.forEach((act)=>{
    const d=document.createElement("div"); d.className="actividad";
    const contactos = act.contactos ? act.contactos.length : 0;
    d.innerHTML=`<div><b>${act.nombre}</b><br>Inicio: ${act.inicioF} ${act.inicioH} - Fin: ${act.finF} ${act.finH}<br>Contactos: ${contactos}</div>`;
    div.appendChild(d);
  });
  actualizarDropdownActividades();
}

// CALENDARIO
function renderCalendario(){
  const grid=document.getElementById("calendar-grid"); grid.innerHTML="";
  const today=new Date(); const year=today.getFullYear(); const month=today.getMonth();
  const firstDay=new Date(year,month,1).getDay(); const totalDays=new Date(year,month+1,0).getDate();
  for(let i=0;i<firstDay;i++){ grid.appendChild(document.createElement("div")); }
  for(let i=1;i<=totalDays;i++){
    const d=document.createElement("div"); d.className="day"; d.innerHTML=i;
    actividades.forEach(act=>{
      const f = new Date(act.inicioF);
      if(f.getDate()===i && f.getMonth()===month){
        const span=document.createElement("span"); span.className="activity-name"; span.innerText=act.nombre; d.appendChild(span);
      }
    });
    grid.appendChild(d);
  }
}
renderCalendario();

// PREVISUALIZACION QSL INDIVIDUAL
const qslFileInputInd = document.getElementById("qslFileIndividual");
const qslPreviewContainerInd = document.getElementById("qslPreviewContainerIndividual");

qslFileInputInd.addEventListener("change", (e)=>{
  qslPreviewContainerInd.innerHTML = "";
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const img = document.createElement("img");
    img.src = reader.result;
    img.title = "Doble click para agrandar";
    img.addEventListener("dblclick", ()=>{
      const popup = document.createElement("div");
      popup.style.position="fixed"; popup.style.top="0"; popup.style.left="0";
      popup.style.width="100%"; popup.style.height="100%";
      popup.style.backgroundColor="rgba(0,0,0,0.8)";
      popup.style.display="flex"; popup.style.justifyContent="center"; popup.style.alignItems="center";
      popup.style.zIndex="1000";
      popup.addEventListener("click", ()=>popup.remove());
      const imgLarge = document.createElement("img"); 
      imgLarge.src = reader.result;
      imgLarge.style.maxWidth="80%"; imgLarge.style.maxHeight="80%";
      imgLarge.style.border="2px solid #1ed6ff"; imgLarge.style.borderRadius="6px";
      popup.appendChild(imgLarge);
      document.body.appendChild(popup);
    });
    qslPreviewContainerInd.appendChild(img);
  };
  reader.readAsDataURL(file);
});

// AGREGAR CONTACTO INDIVIDUAL
function agregarContactoIndividual(){
  const actividadIdx = document.getElementById("actividadSelectIndividual").value;
  const call = document.getElementById("contactCall").value.trim();
  const date = document.getElementById("contactDate").value;
  const time = document.getElementById("contactTime").value;
  const band = document.getElementById("contactBand").value.trim();
  const mode = document.getElementById("contactMode").value.trim();
  const rst = document.getElementById("contactRST").value.trim();
  
  if(!call || !date || !time){ alert("Indicativo, fecha y hora son obligatorios"); return; }

  const local = new Date(`${date}T${time}`);
  const utcDate = new Date(local.getTime() + local.getTimezoneOffset()*60000);
  const utcHora = utcDate.toISOString().substr(11,5); // HH:MM

  const container = document.getElementById("qsoDataContainer");
  const div = document.createElement("div");
  div.innerHTML = `
    <b>${call}</b> (${actividadIdx!=="" ? actividades[actividadIdx].nombre : "Sin actividad"})<br>
    Fecha: ${date}<br>
    Hora UTC: ${utcHora}<br>
    Banda: ${band} | Modo: ${mode} | RST: ${rst}
  `;
  container.prepend(div);
}
</script>

</body>
</html>
